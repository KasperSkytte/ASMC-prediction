---
title: "analysis"
author: "KSA"
date: "9/28/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 10,
  cache = FALSE
)
require("patchwork")
require("data.table")
require("ampvis2")
require("magrittr")
require("stringr")

#knitting will always be done in the context of the Rmd file, otherwise not
if (interactive()) {
  if (!grepl("analysis$", getwd())) {
    setwd("analysis")
  }
}
source("functions.R")
```

```{r}
plot_all("results/20220420")
plot_all("results/20220421")
plot_all("results/20220422")
plot_all("results/20220427")
```

```{r}
results_dir <- "results/20220429/results_20220429_182545"
AAW_20220429 <- combine_abund(
  results_dir,
  cluster_type = "abund"
)

AAW <- load_16sdata(results_dir)
```

```{r}
amp_ordinate(
  AAW_20220429,
  type = "ca",
  sample_color_by = "predicted",
  sample_trajectory = "Date"
)

amp_ordinate(
  AAW,
  type = "ca",
  sample_trajectory = "Date"
)
```

# Check original data
```{r, eval = FALSE}
otutable <- as.data.frame(t(fread("results_20220420_163047/data_reformatted/abundances.csv", data.table = FALSE)))
colnames(otutable) <- otutable[1, ]
otutable <- otutable[-1, ]
otutable[] <- lapply(otutable, as.numeric)

actual <- amp_load(
  otutable = otutable,
  metadata = "results_20220420_163047/data_reformatted/metadata.csv",
  taxonomy = "results_20220420_163047/data_reformatted/taxonomy_wfunctions.csv"
)
amp_timeseries(
  amp_subset_taxa(actual, "ASV1; s__midas_s_5; g__Tetrasphaera", normalise = FALSE),
  time_variable = "Date",
  normalise = FALSE
)
```

