---
title: "analysis"
author: "KSA"
date: "9/28/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 10,
  cache = FALSE
)
require("patchwork")
require("data.table")
require("ampvis2")
require("magrittr")
require("stringr")

#knitting will always be done in the context of the Rmd file, otherwise not
if (interactive()) {
  if (!grepl("analysis$", getwd())) {
    setwd("analysis")
  }
}
source("functions.R")
```

# Prediction accuracy across WWTPs

```{r}
plot_all("results/20220420")
plot_all("results/20220421")
plot_all("results/20220422")
plot_all("results/20220427")
plot_all("results/20220429")
```

# Aalborg West comparison of true vs predicted
```{r}
results_dir <- "results/20220429/results_20220429_182545"
AAW_20220429 <- combine_abund(
  results_dir,
  cluster_type = "abund"
)

AAW <- load_data_reformatted(results_dir)
```

```{r}
amp_ordinate(
  AAW_20220429,
  type = "ca",
  sample_color_by = "predicted",
  sample_trajectory = "Date"
)

amp_ordinate(
  AAW,
  type = "ca",
  sample_trajectory = "Date"
)
```

```{r, eval = FALSE}
amp_timeseries(
  amp_subset_taxa(
    AAW,
    "ASV1; s__midas_s_5; g__Tetrasphaera",
    normalise = FALSE
  ),
  time_variable = "Date",
  normalise = FALSE
)
```

